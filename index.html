<!--SAMPLE TEMPLATE CODE DO NOT USE THIS INDEX.HTML  -->

<!DOCTYPE html>
<html>

<head>
    <title>DynamoDB Form</title>
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.283.1.min.js"></script>
</head>

<body>
    <h1>DynamoDB Form</h1>
    <form id="myForm">
        <label for="name">ID:</label>
        <input type="number" id="id" name="id"><br><br>
        <label for="price">Price:</label>
        <input type="number" id="price" name="price"><br><br>
        <label for="name">Name:</label>
        <input type="text" id="name" name="name"><br><br>
        <input type="submit" value="Submit">
    </form>
    <button id="clear-button">Clear Database</button>
    <button id="dummy-order">Add Dummy Order</button>
    <a
        href="https://adminaccess.auth.us-east-1.amazoncognito.com/oauth2/authorize?client_id=4ooaj9fqj62o64k4523t1ubscb&response_type=code&scope=email+openid+phone&redirect_uri=http%3A%2F%2Flocalhost%3A8000">
        <button>Admin login</button>
    </a>
    
    <script>
        document.getElementById('myForm').addEventListener('submit', function (event) {
            event.preventDefault();
            var form = event.target;
            var data = {
                id: form.elements['id'].value,
                price: form.elements['price'].value,
                name: form.elements['name'].value,
            };
            console.log(data);
            fetch('https://hb8pt1nnyd.execute-api.us-east-1.amazonaws.com/items', {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
                .then(response => response.json())
                .then(result => {
                    console.log(result);
                    alert(result);
                    form.reset();
                })
                .catch(error => {
                    console.error(error);
                    alert('An error occurred. Please try again.');
                });
        });
        AWS.config.update({
            accessKeyId: 'AKIAZQ3DUNFW5M2L3N5U',
            secretAccessKey: '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',
            region: 'us-east-1'
        });
        var ddb = new AWS.DynamoDB({ apiVersion: 'latest' });

        // Define the parameters for the query
        var params = {
            TableName: 'order-database'
        };

        // Scan the DynamoDB table
        ddb.scan(params, function (err, data) {
            if (err) {
                console.log("Error", err);
            } else {
                // Log the data retrieved from DynamoDB
                console.log("Success", data.Items);

                // Convert the data to HTML and add it to your webpage
                var html = '<table>';
                html += '<tr><th>ID</th><th>Price</th><th>Name</th></tr>'; // Add the header row
                data.Items.forEach(function (item) {
                    html += '<tr>';
                    html += '<td>' + item['id'].S + '</td>';
                    html += '<td>' + item['price'].S + '</td>';
                    html += '<td>' + item['name'].S + '</td>';
                    html += '</tr>';
                });
                html += '</table>';

                // Add the HTML to your webpage
                document.getElementById('items').innerHTML = html;
            }
        });
            document.getElementById('clear-button').addEventListener('click', function () {
                var db = new AWS.DynamoDB.DocumentClient()
                // Scan the DynamoDB table
                db.scan(params, function (err, data) {
                    if (err) {
                        console.log("Error", err);
                    } else {
                        // Log the data retrieved from DynamoDB
                        console.log("Success", data.Items);

                        data.Items.forEach(function (item) {
                            var params = {
                                TableName: 'order-database',
                                Key: {
                                    'id': item.id
                                }
                            };

                            db.delete(params, function (err, data) {
                                if (err) {
                                    console.error("Unable to delete item. Error JSON:", JSON.stringify(err, null, 2));
                                } else {
                                    console.log("DeleteItem succeeded:", JSON.stringify(data, null, 2));
                                }
                            });
                            var params = {
                                TableName: 'current-orders',
                                Key: {
                                    'order-id': item['order-id']
                                }
                            };

                            db.delete(params, function (err, data) {
                                if (err) {
                                    console.error("Unable to delete item. Error JSON:", JSON.stringify(err, null, 2));
                                } else {
                                    console.log("DeleteItem succeeded:", JSON.stringify(data, null, 2));
                                }
                            });
                        });
                    }
                });
            });

            document.getElementById('dummy-order').addEventListener('click', function () {
                var data = {
                    'order-id': 1,
                    amount: 50,
                    'order-status': 'pending',
                };
                console.log(data);
                fetch('https://hb8pt1nnyd.execute-api.us-east-1.amazonaws.com/orders', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                }).then(response => response.json())
                .then(result => {
                    console.log(result);
                    alert(result);
                })
                .catch(error => {
                    console.error(error);
                    alert('An error occurred. Please try again.');
                });
            });
    </script>
    <h1>Data</h1>
    <div id="items"></div>
</body>

</html>
